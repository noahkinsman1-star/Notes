<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>1Notes</title>

<style>
:root {
  --bg: #ffffff;
  --text: #000000;
  --subtext: #444;
  --toolbar: #f2f2f2;
  --button: #e0e0e0;
}

@media (prefers-color-scheme: dark) {
  :root {
    --bg: #121212;
    --text: #ffffff;
    --subtext: #cccccc;
    --toolbar: #1e1e1e;
    --button: #333333;
  }
}

body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
}

.hidden { display: none; }

/* ---------- Notes List ---------- */
#list {
  padding: 16px;
}

.note-item {
  padding: 12px;
  border-bottom: 1px solid #ddd;
  cursor: pointer;
}

.note-item small {
  color: var(--subtext);
}

/* ---------- Editor ---------- */
#editor {
  padding: 16px;
  padding-bottom: 90px;
}

.line {
  outline: none;
  margin: 4px 0;
  line-height: 1.35;
}

.normal { font-size: 17px; }
.title { font-size: 26px; font-weight: 700; }
.subtitle { font-size: 20px; font-weight: 600; }

/* ---------- Toolbar ---------- */
.toolbar {
  position: fixed;
  left: 0;
  width: 100%;
  display: flex;
  gap: 6px;
  padding: 8px;
  background: var(--toolbar);
  border-top: 1px solid #ccc;
  z-index: 100;
}

.toolbar button {
  padding: 6px 10px;
  border: none;
  border-radius: 6px;
  background: var(--button);
  color: var(--text);
}

.toolbar button:active {
  transform: scale(0.95);
}
</style>
</head>

<body>

<div id="list"></div>

<div id="editorScreen" class="hidden">
  <div id="editor"></div>
</div>

<div class="toolbar hidden" id="toolbar">
  <button onclick="setLine('title')">Title</button>
  <button onclick="setLine('subtitle')">Subtitle</button>
  <button onclick="setLine('normal')">Text</button>
  <button onclick="cmd('bold')"><b>B</b></button>
  <button onclick="cmd('italic')"><i>I</i></button>
  <button onclick="cmd('underline')"><u>U</u></button>
  <button onclick="cmd('insertUnorderedList')">•</button>
  <button onclick="insertCheckbox()">☐</button>
</div>

<script>
let notes = JSON.parse(localStorage.getItem("notes") || "[]");
let currentId = null;
const list = document.getElementById("list");
const editor = document.getElementById("editor");
const screen = document.getElementById("editorScreen");
const toolbar = document.getElementById("toolbar");

/* ---------- Save ---------- */
function save() {
  localStorage.setItem("notes", JSON.stringify(notes));
}

/* ---------- List ---------- */
function showList() {
  list.innerHTML = "";
  notes.sort((a,b)=>b.updated-a.updated);
  notes.forEach(n=>{
    const d = document.createElement("div");
    d.className = "note-item";
    d.innerHTML = `<strong>${n.text.split("\n")[0] || "New Note"}</strong><br><small>${new Date(n.updated).toLocaleString()}</small>`;
    d.onclick = ()=>openNote(n.id);
    list.appendChild(d);
  });
}

/* ---------- Editor ---------- */
function openNote(id=null) {
  screen.classList.remove("hidden");
  toolbar.classList.remove("hidden");
  list.classList.add("hidden");

  if (!id) {
    id = Date.now();
    notes.push({id, text:"", updated:Date.now()});
  }

  currentId = id;
  editor.innerHTML = "";
  const note = notes.find(n=>n.id===id);

  note.text.split("\n").forEach(t=>addLine("normal",t));
}

function addLine(type,text="") {
  const d = document.createElement("div");
  d.className = `line ${type}`;
  d.contentEditable = true;
  d.textContent = text;
  editor.appendChild(d);

  d.addEventListener("keydown",e=>{
    if (e.key==="Enter") {
      e.preventDefault();
      addLine("normal","");
      placeCaret(editor.lastChild);
    }
    if (e.key==="Backspace" && d.textContent==="") {
      const p=d.previousElementSibling;
      if(p){e.preventDefault();d.remove();placeCaret(p);}
    }
    autoSave();
  });

  d.onclick=()=>{
    if(d.textContent.startsWith("☐ "))d.textContent="☑ "+d.textContent.slice(2);
    else if(d.textContent.startsWith("☑ "))d.textContent="☐ "+d.textContent.slice(2);
  };
}

function autoSave() {
  const note = notes.find(n=>n.id===currentId);
  note.text = [...editor.children].map(l=>l.textContent).join("\n");
  note.updated = Date.now();

  if (!note.text.trim()) {
    notes = notes.filter(n=>n.id!==currentId);
    back();
  }
  save();
}

function back() {
  screen.classList.add("hidden");
  toolbar.classList.add("hidden");
  list.classList.remove("hidden");
  showList();
}

/* ---------- Formatting ---------- */
function setLine(type){
  document.activeElement.className=`line ${type}`;
}
function cmd(c){document.execCommand(c);}
function insertCheckbox(){document.execCommand("insertText",false,"☐ ");}

/* ---------- Caret ---------- */
function placeCaret(el){
  const r=document.createRange();
  r.selectNodeContents(el);
  r.collapse(false);
  const s=window.getSelection();
  s.removeAllRanges();
  s.addRange(r);
}

/* ---------- Start ---------- */
showList();
</script>

</body>
</html>
