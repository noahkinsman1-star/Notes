<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>1Notes</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #ffffff;
}

/* ---------- NOTES LIST ---------- */
#notesList {
  padding: 16px;
}

.note-item {
  padding: 12px;
  border-bottom: 1px solid #eee;
  font-size: 18px;
}

.note-item:active {
  background: #f2f2f2;
}

#newNoteBtn {
  width: 100%;
  padding: 12px;
  margin-bottom: 12px;
  font-size: 16px;
  border: none;
  border-radius: 8px;
  background: #e0e0e0;
}

/* ---------- EDITOR ---------- */
#editorScreen {
  display: none;
}

#editor {
  padding: 16px;
  padding-bottom: 100px;
}

.line {
  outline: none;
  margin: 4px 0;
  line-height: 1.35;
}

.title { font-size: 26px; font-weight: 700; }
.subtitle { font-size: 20px; font-weight: 600; }
.normal { font-size: 18px; font-weight: 400; }

/* ---------- TOOLBAR ---------- */
.toolbar {
  position: fixed;
  left: 0;
  bottom: 0;
  width: 100%;
  display: flex;
  gap: 6px;
  padding: 8px;
  background: #f2f2f2;
  border-top: 1px solid #ddd;
  z-index: 999;
}

.toolbar button {
  padding: 6px 10px;
  font-size: 14px;
  border: none;
  border-radius: 6px;
  background: #e0e0e0;
}

.toolbar button:active {
  background: #cfcfcf;
  transform: scale(0.95);
}

/* ---------- TOP BAR ---------- */
.topbar {
  padding: 12px;
  border-bottom: 1px solid #ddd;
  display: flex;
  align-items: center;
}

.topbar button {
  border: none;
  background: none;
  font-size: 16px;
}
</style>
</head>

<body>

<!-- NOTES LIST SCREEN -->
<div id="notesList">
  <button id="newNoteBtn">New Note</button>
  <div id="notesContainer"></div>
</div>

<!-- EDITOR SCREEN -->
<div id="editorScreen">
  <div class="topbar">
    <button onclick="backToList()">← Notes</button>
  </div>

  <div id="editor"></div>

  <div class="toolbar" id="toolbar">
    <button onclick="setLineStyle('title')">Title</button>
    <button onclick="setLineStyle('subtitle')">Subtitle</button>
    <button onclick="setLineStyle('normal')">Text</button>
    <button onclick="formatText('bold')"><b>B</b></button>
    <button onclick="formatText('italic')"><i>I</i></button>
    <button onclick="formatText('underline')"><u>U</u></button>
    <button onclick="insertBullet()">•</button>
    <button onclick="insertCheckbox()">☐</button>
  </div>
</div>

<script>
const notesKey = "notes-data";
let notes = JSON.parse(localStorage.getItem(notesKey)) || [];
let currentNoteIndex = null;

const notesList = document.getElementById("notesList");
const notesContainer = document.getElementById("notesContainer");
const editorScreen = document.getElementById("editorScreen");
const editor = document.getElementById("editor");
const toolbar = document.getElementById("toolbar");

let currentLine = null;

/* ---------- NOTES LIST ---------- */
function renderNotes() {
  notesContainer.innerHTML = "";
  notes.forEach((note, i) => {
    const div = document.createElement("div");
    div.className = "note-item";
    div.textContent = note.preview || "New Note";
    div.onclick = () => openNote(i);
    notesContainer.appendChild(div);
  });
}

document.getElementById("newNoteBtn").onclick = () => {
  notes.push({ content: "", preview: "" });
  localStorage.setItem(notesKey, JSON.stringify(notes));
  openNote(notes.length - 1);
};

/* ---------- OPEN / CLOSE ---------- */
function openNote(index) {
  currentNoteIndex = index;
  notesList.style.display = "none";
  editorScreen.style.display = "block";
  editor.innerHTML = notes[index].content || "";
  if (!editor.innerHTML) createLine();
}

function backToList() {
  saveNote();
  editorScreen.style.display = "none";
  notesList.style.display = "block";
  renderNotes();
}

/* ---------- SAVE ---------- */
function saveNote() {
  const text = editor.innerText.trim();
  if (!text) {
    notes.splice(currentNoteIndex, 1);
  } else {
    notes[currentNoteIndex] = {
      content: editor.innerHTML,
      preview: text.split("\n")[0]
    };
  }
  localStorage.setItem(notesKey, JSON.stringify(notes));
}

/* ---------- EDITOR (UNCHANGED) ---------- */
function createLine(type = "normal", after = null) {
  const div = document.createElement("div");
  div.className = `line ${type}`;
  div.contentEditable = "true";
  div.setAttribute("spellcheck", "true");

  if (after) editor.insertBefore(div, after.nextSibling);
  else editor.appendChild(div);

  currentLine = div;
  placeCaretAtEnd(div);

  div.addEventListener("focus", () => currentLine = div);

  div.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      e.preventDefault();
      createLine("normal", div);
    }

    if (e.key === "Backspace" && div.textContent === "") {
      const prev = div.previousElementSibling;
      if (prev) {
        e.preventDefault();
        div.remove();
        placeCaretAtEnd(prev);
      }
    }
  });

  div.addEventListener("click", () => {
    if (div.textContent.startsWith("☐ ")) {
      div.textContent = "☑ " + div.textContent.slice(2);
      placeCaretAtEnd(div);
    } else if (div.textContent.startsWith("☑ ")) {
      div.textContent = "☐ " + div.textContent.slice(2);
      placeCaretAtEnd(div);
    }
  });
}

function setLineStyle(type) {
  if (!currentLine) return;
  currentLine.className = `line ${type}`;
  currentLine.focus();
}

function formatText(cmd) { document.execCommand(cmd); }
function insertBullet() { document.execCommand("insertUnorderedList"); }
function insertCheckbox() { document.execCommand("insertText", false, "☐ "); }

function placeCaretAtEnd(el) {
  el.focus();
  const range = document.createRange();
  range.selectNodeContents(el);
  range.collapse(false);
  const sel = window.getSelection();
  sel.removeAllRanges();
  sel.addRange(range);
}

/* ---------- START ---------- */
renderNotes();
</script>

</body>
</html>
