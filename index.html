<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>1Notes</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #fff;
}

/* ===== Screens ===== */
.screen {
  display: none;
}
.screen.active {
  display: block;
}

/* ===== Notes List ===== */
#notesList {
  padding: 16px;
}
.note-item {
  padding: 12px;
  border-bottom: 1px solid #eee;
}
.note-item strong {
  display: block;
}
.new-note {
  position: fixed;
  bottom: 20px;
  right: 20px;
  font-size: 28px;
  border-radius: 50%;
  width: 56px;
  height: 56px;
}

/* ===== Editor ===== */
#editor {
  padding: 16px;
  padding-bottom: 90px;
}

.line {
  outline: none;
  margin: 4px 0;
  line-height: 1.35;
}

.normal { font-size: 18px; }
.title { font-size: 28px; font-weight: 700; }
.subtitle { font-size: 22px; font-weight: 600; }

/* ===== Toolbar ===== */
.toolbar {
  position: fixed;
  left: 0;
  width: 100%;
  display: flex;
  gap: 6px;
  padding: 8px;
  background: #f2f2f2;
  border-top: 1px solid #ddd;
}

.toolbar button {
  padding: 6px 10px;
  border-radius: 6px;
  border: none;
}

/* Checkbox */
.checkbox {
  cursor: pointer;
  user-select: none;
}
</style>
</head>

<body>

<!-- NOTES LIST -->
<div id="listScreen" class="screen active">
  <div id="notesList"></div>
  <button class="new-note" onclick="createNote()">＋</button>
</div>

<!-- EDITOR -->
<div id="editorScreen" class="screen">
  <div id="editor"></div>

  <div class="toolbar" id="toolbar">
    <button onclick="setStyle('title')">Title</button>
    <button onclick="setStyle('subtitle')">Subtitle</button>
    <button onclick="setStyle('normal')">Text</button>
    <button onclick="document.execCommand('bold')"><b>B</b></button>
    <button onclick="document.execCommand('italic')"><i>I</i></button>
    <button onclick="document.execCommand('underline')"><u>U</u></button>
    <button onclick="insertCheckbox()">☐</button>
  </div>
</div>

<script>
/* ===== Storage ===== */
let notes = JSON.parse(localStorage.getItem("notes") || "[]");
let currentNote = null;
const notesList = document.getElementById("notesList");
const editor = document.getElementById("editor");

/* ===== Navigation ===== */
function show(screen) {
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.getElementById(screen).classList.add("active");
}

/* ===== Notes List ===== */
function renderList() {
  notesList.innerHTML = "";
  notes.forEach((n, i) => {
    const div = document.createElement("div");
    div.className = "note-item";
    div.innerHTML = `<strong>${n.preview || "New Note"}</strong>`;
    div.onclick = () => openNote(i);
    notesList.appendChild(div);
  });
}
renderList();

/* ===== Create / Open ===== */
function createNote() {
  const note = { content: "", preview: "" };
  notes.unshift(note);
  save();
  openNote(0);
}

function openNote(index) {
  currentNote = index;
  editor.innerHTML = "";
  if (notes[index].content) {
    editor.innerHTML = notes[index].content;
    rebindLines();
  } else {
    createLine();
  }
  show("editorScreen");
}

/* ===== Editor Lines ===== */
function createLine(type="normal") {
  const div = document.createElement("div");
  div.className = `line ${type}`;
  div.contentEditable = true;
  editor.appendChild(div);
  placeCaret(div);

  div.onkeydown = e => {
    if (e.key === "Enter") {
      e.preventDefault();
      createLine();
    }
    if (e.key === "Backspace" && div.textContent === "") {
      const prev = div.previousElementSibling;
      if (prev) {
        e.preventDefault();
        div.remove();
        placeCaret(prev);
      }
    }
  };

  div.onclick = e => {
    if (e.target.classList.contains("checkbox")) {
      e.target.textContent = e.target.textContent === "☐" ? "☑" : "☐";
    }
  };
}

function rebindLines() {
  document.querySelectorAll(".line").forEach(l => {
    l.contentEditable = true;
  });
}

/* ===== Formatting ===== */
function setStyle(type) {
  const sel = window.getSelection();
  if (!sel.anchorNode) return;
  const line = sel.anchorNode.closest(".line");
  if (line) line.className = `line ${type}`;
}

function insertCheckbox() {
  document.execCommand("insertHTML", false, `<span class="checkbox">☐</span> `);
}

/* ===== Caret ===== */
function placeCaret(el) {
  el.focus();
  const r = document.createRange();
  r.selectNodeContents(el);
  r.collapse(false);
  const s = window.getSelection();
  s.removeAllRanges();
  s.addRange(r);
}

/* ===== Auto Save ===== */
function save() {
  localStorage.setItem("notes", JSON.stringify(notes));
}

setInterval(() => {
  if (currentNote !== null) {
    notes[currentNote].content = editor.innerHTML;
    notes[currentNote].preview =
      editor.textContent.trim().split("\n")[0] || "";
    save();
  }
}, 500);

/* ===== Back gesture ===== */
window.onpopstate = () => {
  show("listScreen");
  renderList();
};
</script>

</body>
</html>
